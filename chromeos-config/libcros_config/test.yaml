#
# Copyright 2018 The Chromium OS Authors. All rights reserved.
#
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

touch: &touch
  $fw_root: "/lib/firmware"
  $fw_dest: "/opt/google/touch/firmware"

audio: &audio
  main:
    $cras_root: "/etc/cras"
    $ucm_root: "/usr/share/alsa/ucm"
    $fw_root: "/lib/firmware"
    $card: "a-card"

    cras-config-dir: "{{$name}}"
    ucm-suffix: "{{$name}}"

    $volume: "{{cras-config-dir}}/{{$card}}"
    $dsp-ini: "{{cras-config-dir}}/dsp.ini"
    $hifi-conf: "{{$card}}.{{ucm-suffix}}/HiFi.conf"
    $alsa-conf: "{{$card}}.{{ucm-suffix}}/{{$card}}.{{ucm-suffix}}.conf"
    $topology-bin: "{{$topology-name}}-tplg.bin"

    files:
      - source: "cras-config/{{$volume}}"
        destination: "{{$cras_root}}/{{$volume}}"
      - source: "cras-config/{{$dsp-ini}}"
        destination: "{{$cras_root}}/{{$dsp-ini}}"
      - source: "ucm-config/{{$hifi-conf}}"
        destination: "{{$ucm_root}}/{{$hifi-conf}}"
      - source: "ucm-config/{{$alsa-conf}}"
        destination: "{{$ucm_root}}/{{$alsa-conf}}"
      - source: "topology/{{$topology-bin}}"
        destination: "{{$fw_root}}/{{$topology-bin}}"

some_base_config: &some_base_config
  name: "{{$name}}"
  arc:
    files:
      - source: "some/hardware_features"
        destination: "/usr/share/chromeos-config/sbin/some/hardware_features"
  firmware:
    bcs-overlay: "overlay-some-private"
    build-targets:
      coreboot: "some"
      ec: "some"
      depthcharge: "some"
      libpayload: "some"

    ec-image: "bcs://Some_EC.1111.11.1.tbz2"
    main-image: "bcs://Some.1111.11.1.tbz2"
    main-rw-image: "bcs://Some_RW.1111.11.1.tbz2"
  firmware-signing:
    key-id: "{{$key-id}}"

some_config: &some_config
  <<: *some_base_config
  audio:
    <<: *audio
    $topology-name: "some"
  identity:
    platform-name: "Some"
    smbios-name-match: "Some"
    sku-id: "{{$sku-id}}"
  wallpaper: "some"

some_whitelabel_config: &some_whitelabel_config
  <<: *some_base_config
  identity:
    platform-name: "Some"
    smbios-name-match: "Some"
    sku-id: "{{$sku-id}}"
    customization-id: "{{$customization-id}}"

some_touch_config: &some_touch_config
  <<: *touch
  $some_stylus: "some_stylus_vendor/some-version.hex"
  $some_touchscreen: "some_touch_vendor/some-pid_some-version.bin"
  $some_other_touchscreen: "some_touch_vendor/some-other-pid_some-other-version.bin"

  files:
    - source: "{{$some_stylus}}"
      destination: "{{$fw_dest}}/{{$some_stylus}}"
      symlink: "{{$fw_root}}/some_stylus_vendor_firmware_SOME.bin"
    - source: "{{$some_touchscreen}}"
      destination: "{{$fw_dest}}/{{$some_touchscreen}}"
      symlink: "{{$fw_root}}/some_touch_vendorts_i2c_some-pid.bin"
    - source: "{{$some_other_touchscreen}}"
      destination: "{{$fw_dest}}/{{$some_other_touchscreen}}"
      symlink: "{{$fw_root}}/some_touch_vendorts_i2c_some-other-pid.bin"

chromeos:
  devices:
    - $name: "some"
      products:
        - $key-id: "SOME"
      skus:
        - $sku-id: 0
          config:
            <<: *some_config
            touch:
              <<: *some_touch_config
              present: "probe"
              probe-regex: "some-prob-regex"
            thermal:
              files:
                - source: "some_touch/dptf.dv"
                  destination: "/etc/dptf/some_touch/dptf.dv"
        - $sku-id: 1
          config:
            <<: *some_config
            touch:
              <<: *some_touch_config
              present: "no"
            thermal:
              files:
                - source: "some_notouch/dptf.dv"
                  destination: "/etc/dptf/some_notouch/dptf.dv"
    - $name: "another"
      products:
        - $key-id: "ANOTHER"
      skus:
        - config:
            name: "{{$name}}"
            audio:
              <<: *audio
              $topology-name: "another"
            identity:
              platform-name: "Another"
              smbios-name-match: "Another"
            firmware:
              bcs-overlay: "overlay-another-private"

              ec-image: "bcs://Another_EC.1111.11.1.tbz2"
              main-image: "bcs://Another.1111.11.1.tbz2"
              main-rw-image: "bcs://Another_RW.1111.11.1.tbz2"
              build-targets:
                coreboot: "another"
                ec: "another"
                depthcharge: "another"
                libpayload: "another"
            firmware-signing:
              key-id: "{{$key-id}}"
            touch:
              <<: *touch
              present: "probe"
              probe-regex: "another-prob-regex"

              $some_stylus: "some_stylus_vendor/another-version.hex"
              $some_touchscreen: "some_touch_vendor/some-pid_some-version.bin"

              files:
                - source: "{{$some_stylus}}"
                  destination: "{{$fw_dest}}/{{$some_stylus}}"
                  symlink: "{{$fw_root}}/some_stylus_vendor_firmware_ANOTHER.bin"
                - source: "{{$some_touchscreen}}"
                  destination: "{{$fw_dest}}/{{$some_touchscreen}}"
                  symlink: "{{$fw_root}}/some_touch_vendorts_i2c_some-pid.bin"
            thermal:
              files:
                - source: "another/dptf.dv"
                  destination: "/etc/dptf/another/dptf.dv"
            wallpaper: "default"
    - $name: "whitelabel"
      products:
        - $brand-code: "WLBA"
          $key-id: "WHITELABEL1"
          $wallpaper: "wallpaper-wl1"
          $customization-id: "WHITELABELA"
        - $brand-code: "WLBB"
          $key-id: "WHITELABEL2"
          $wallpaper: "wallpaper-wl2"
          $customization-id: "WHITELABELB"
      skus:
        - $sku-id: 8
          config:
            <<: *some_whitelabel_config
            wallpaper: "{{$wallpaper}}"
            touch:
              <<: *some_touch_config
              present: "yes"
              probe-regex: "some-prob-regex"
        - $sku-id: 9
          config:
            <<: *some_whitelabel_config
            wallpaper: "{{$wallpaper}}"
            touch:
              <<: *some_touch_config
              present: "no"

