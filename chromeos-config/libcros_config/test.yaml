#
# Copyright 2018 The Chromium OS Authors. All rights reserved.
#
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

reef-build-targets: &reef_build_targets
  coreboot: "reef"
  ec: "reef"
  depthcharge: "reef"
  libpayload: "reef"

touch: &touch
  present: "probe"
  probe-regex: "[Tt]ouchscreen|WCOMNTN2"

  $fw_root: "/lib/firmware"
  $fw_dest: "/opt/google/touch/firmware"

audio_common: &audio_common
  $cras_root: "/etc/cras"
  $ucm_root: "/usr/share/alsa/ucm"
  $fw_root: "/lib/firmware"
  $card: "bxtda7219max"

  files:
    - source: "cras-config/{{$volume}}"
      destination: "{{$cras_root}}/{{$volume}}"
    - source: "cras-config/{{$dsp-ini}}"
      destination: "{{$cras_root}}/{{$dsp-ini}}"
    - source: "ucm-config/{{$hifi-conf}}"
      destination: "{{$ucm_root}}/{{$hifi-conf}}"
    - source: "ucm-config/{{$alsa-conf}}"
      destination: "{{$ucm_root}}/{{$alsa-conf}}"
    - source: "topology/{{$topology-bin}}"
      destination: "{{$fw_root}}/{{$topology-bin}}"

audio: &audio
  main:
    <<: *audio_common
    cras-config-dir: "{{$name}}"
    ucm-suffix: "{{$name}}"

    $volume: "{{cras-config-dir}}/{{$card}}"
    $dsp-ini: "{{cras-config-dir}}/dsp.ini"
    $hifi-conf: "{{$card}}.{{ucm-suffix}}/HiFi.conf"
    $alsa-conf: "{{$card}}.{{ucm-suffix}}/{{$card}}.{{ucm-suffix}}.conf"
    $topology-bin: "5a98-reef-{{$topology-name}}-{{$sku-id}}-tplg.bin"

audio_with_customization_id: &audio_with_customization_id
  main:
    <<: *audio_common
    cras-config-dir: "{{$topology-name}}/{{$customization-id}}"
    ucm-suffix: "{{$topology-name}}.{{$customization-id}}"

    $volume: "{{$topology-name}}/{{$customization-id}}/{{$card}}"
    $dsp-ini: "{{$topology-name}}/{{$customization-id}}/dsp.ini"
    $hifi-conf: "{{$card}}.{{$topology-name}}.{{$customization-id}}/HiFi.conf"
    $alsa-conf: "{{$card}}.{{$topology-name}}.{{$customization-id}}/{{$card}}.{{$topology-name}}.{{$customization-id}}.conf"
    $topology-bin: "5a98-reef-{{$topology-name}}-{{$sku-id}}-tplg.bin"

base_config: &base_config
  arc:
    files:
      - source: "hardware_features.xml"
        destination: "/etc/hardware_features.xml"
    build-properties:
      device: "reef_cheets"
      marketing-name: "{{$marketing-name}}"
  brand-code: "{{$brand-code}}"
  name: "{{$name}}"

reef_config: &reef_config
  <<: *base_config
  audio:
    <<: *audio_with_customization_id
    $topology-name: "reef"
  identity:
    platform-name: "Reef"
    smbios-name-match: "Reef"
    sku-id: "{{$sku-id}}"
  firmware:
    bcs-overlay: "overlay-reef-private"
    build-targets:
      <<: *reef_build_targets
      cr50: "cr50"

    ec-image: "bcs://Reef_EC.9042.87.1.tbz2"
    main-image: "bcs://Reef.9042.87.1.tbz2"
    main-rw-image: "bcs://Reef.9042.110.0.tbz2"
  firmware-signing:
    key-id: "{{$key-id}}"
  powerd-prefs: "reef"
  test-label: "reef"

snappy_config: &snappy_config
  <<: *base_config
  audio:
    <<: *audio_with_customization_id
    $topology-name: "snappy"
  identity:
    platform-name: "Snappy"
    smbios-name-match: "Snappy"
    sku-id: "{{$sku-id}}"
  firmware:
    bcs-overlay: "overlay-snappy-private"
    build-targets: *reef_build_targets

    bcs-overlay: "overlay-snappy-private"
    ec-image: "bcs://Snappy_EC.9042.178.0.tbz2"
    main-image: "bcs://Snappy.9042.178.0.tbz2"

    # TODO(shapiroc): snappy's keys haven't yet been merged
    # into reef. Later, this should be "SNAPPY".
    no-firmware: true
  firmware-signing:
    key-id: "{{$key-id}}"
  powerd-prefs: "snappy"
  test-label: "snappy"
  wallpaper: "snappy"
  touch:
    <<: *touch
    $wacom: "wacom/wacom_1606.hex"
    $elan_0: "elan/158.0_2.0.bin"
    $elan_1: "elan/2be2_5603.bin"
    $weida: "weida/01017401_2083_0133ec86.bin"

    files:
      - source: "{{$wacom}}"
        destination: "{{$fw_dest}}/{{$wacom}}"
        symlink: "{{$fw_root}}/wacom_firmware_SNAPPY.hex"
      - source: "{{$elan_0}}"
        destination: "{{$fw_dest}}/{{$elan_0}}"
        symlink: "{{$fw_root}}/elan_i2c_158.0.bin"
      - source: "{{$elan_1}}"
        destination: "{{$fw_dest}}/{{$elan_1}}"
        symlink: "{{$fw_root}}/elants_i2c_2be2.bin"
      - source: "{{$weida}}"
        destination: "{{$fw_dest}}/{{$weida}}"
        symlink: "{{$fw_root}}/wdt87xx.bin"

chromeos:
  devices:
    - $name: "electro"
      products:
        - $marketing-name: "Acer Chromebook Spin 11 (R751T)"
          $brand-code: "ACBB"
          $key-id: "PARMA"
          $customization-id: "ELECTRO"
      skus:
        - $sku-id: 8
          config:
            <<: *reef_config
            touch:
              <<: *touch
              $wacom: "wacom/wacom_1636.hex"
              $elan_0: "elan/154.0_2.0.bin"
              $elan_1: "1cd2_5603.bin"

              files:
                - source: "{{$wacom}}"
                  destination: "{{$fw_dest}}/{{$wacom}}"
                  symlink: "{{$fw_root}}/wacom_firmware_ELECTRO.hex"
                - source: "{{$elan_0}}"
                  destination: "{{$fw_dest}}/{{$elan_0}}"
                  symlink: "{{$fw_root}}/elan_i2c_154.0.bin"
                - source: "{{$elan_1}}"
                  destination: "{{$fw_dest}}/{{$elan_1}}"
                  symlink: "{{$fw_root}}/elants_i2c_1cd2.bin"

    - $name: "basking"
      products:
        - $marketing-name: "ASUS Chromebook C213NA"
          $brand-code: "ASUN"
          $key-id: "OEM2"
          $customization-id: "BASKING"
      skus:
        - $sku-id: 0
          config:
            <<: *reef_config
            touch:
              <<: *touch
              $wacom: "wacom/wacom_4209.hex"
              $elan_0: "elan/97.0_6.0.bin"
              $elan_1: "elan/3062_5602.bin"
              $elan_2: "elan/306e_5611.bin"

              files:
                - source: "{{$wacom}}"
                  destination: "{{$fw_dest}}/{{$wacom}}"
                  symlink: "{{$fw_root}}/wacom_firmware_BASKING.hex"
                - source: "{{$elan_0}}"
                  destination: "{{$fw_dest}}/{{$elan_0}}"
                  symlink: "{{$fw_root}}/elan_i2c_97.0.bin"
                - source: "{{$elan_1}}"
                  destination: "{{$fw_dest}}/{{$elan_1}}"
                  symlink: "{{$fw_root}}/elants_i2c_3062.bin"
                - source: "{{$elan_2}}"
                  destination: "{{$fw_dest}}/{{$elan_2}}"
                  symlink: "{{$fw_root}}/elants_i2c_306e.bin"

    - $name: "pyro"
      products:
        - $brand-code: "LEAN"
          $marketing-name: "Lenovo Thinkpad 11e Chromebook (4th Gen)/Lenovo Thinkpad Yoga 11e Chromebook (4th Gen)"
          $key-id: "PYRO"
      skus:
        - $sku-id: 8
          config:
            <<: *base_config
            audio:
              <<: *audio
              $topology-name: "reef"
            identity:
              platform-name: "Pyro"
              smbios-name-match: "Pyro"
            firmware:
              bcs-overlay: "overlay-pyro-private"

              ec-image: "bcs://Pyro_EC.9042.87.1.tbz2"
              main-image: "bcs://Pyro.9042.87.1.tbz2"
              main-rw-image: "bcs://Pyro.9042.110.0.tbz2"
              # TODO(shapiroc): pyro's keys haven't yet been merged into
              # reef. Later, this should be "PYRO".
              no-firmware: true

              build-targets: *reef_build_targets
            touch:
              <<: *touch
              $wacom: "wacom/wacom_769.hex"
              $elan_0: "elan/155.0_2.0.bin"

              files:
                - source: "{{$wacom}}"
                  destination: "{{$fw_dest}}/{{$wacom}}"
                  symlink: "{{$fw_root}}/wacom_firmware_PYRO.hex"
                - source: "{{$elan_0}}"
                  destination: "{{$fw_dest}}/{{$elan_0}}"
                  symlink: "{{$fw_root}}/elan_i2c_155.0.bin"

    - $name: "sand"
      products:
        - $marketing-name: "Chromebook 15 CB515-1HT/1H"
          $brand-code: "ACBD"
          $key-id: "SAND"
      skus:
        - $sku-id: 8
          config:
            <<: *base_config
            audio:
              <<: *audio
              $topology-name: "sand"
            identity:
              platform-name: "Sand"
              smbios-name-match: "Sand"
            firmware:
              bcs-overlay: "overlay-sand-private"
              ec-image: "bcs://Sand_EC.9042.178.0.tbz2"
              main-image: "bcs://Sand.9042.178.0.tbz2"
              # TODO(shapiroc): sands's keys haven't yet been merged into
              # reef. Later, this should be "SAND".
              no-firmware: true
              build-targets: *reef_build_targets
            touch:
              <<: *touch
              $raydium: "raydium/raydium_0xa2001023_1.1.bin"
              $elan: "elan/85.0_11.0.bin"

              files:
                - source: "{{$raydium}}"
                  destination: "{{$fw_dest}}/{{$raydium}}"
                  symlink: "{{$fw_root}}/raydium.fw"
                - source: "{{$elan}}"
                  destination: "{{$fw_dest}}/{{$elan}}"
                  symlink: "{{$fw_root}}/elan_i2c_85.0.bin"

    - $name: "snappy"
      products:
        - $brand-code: "HPZO"
          $marketing-name: "HP Chromebook x360 11 G1 EE"
          $customization-id: "SNAPPY"
          $key-id: "SNAPPY"
      skus:
        - $sku-id: 8
          config: *snappy_config

    - $name: "alan"
      products:
        - $brand-code: "CLSF"
          $marketing-name: "HP Chromebook 11 G6 EE"
          $customization-id: "ALAN"
          $key-id: "ALAN"
      skus:
        - $sku-id: 7
          config: *snappy_config

    - $name: "bigdaddy"
      products:
        - $brand-code: "FQZI"
          $marketing-name: "HP Chromebook 14 G5"
          $customization-id: "BIGDADDY"
          $key-id: "BIGDADDY"
      skus:
        - $sku-id: 2
          config: *snappy_config

        - $sku-id: 5
          config: *snappy_config

