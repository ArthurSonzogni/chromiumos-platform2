# Copyright 2017 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

description   "Start camera HAL v3 adapter service"
author        "chromium-os-dev@chromium.org"

# The camera HAL v3 adapter service needs to start before android starts.
# We start it after system service starts, if it hasn't completed
# before android starts then it will block android from starting.
# Blocking logic is controlled by camera HAL v3 in the container.
start on started system-services
expect fork
respawn

# The user arc-camera and the binary arc_camera3_service have arc in its
# naming for historical reasons (carried from camera HAL v1). For camera
# HAL v3 they are not just ARC-specific: Chrome will need to talk to
# arc_camera3_service to access camera, too.

pre-start exec install -d -m 750 -o arc-camera -g arc-camera /run/camera

# Need -G to be in video group to access /dev/video*
exec minijail0 -i -u arc-camera -g arc-camera -G -- /usr/bin/arc_camera3_service
