# Kdump

Fully featured kernel debugging after a crash has happened, aka `ramoops on steroids`.

The kdump feature is controlled by the `kdump` USE flag. This is currently
enabled only on dev/test images of amd64 boards.

To enable kdump on a supported device, run the following command to change the
kernel booot cmdline parameters and reboot to make it take effect:
```sh
/usr/share/vboot/bin/make_dev_ssd.sh --partitions 2 --enable_kdump
```

After a kernel crash, the generated dump files can be found in `/var/spool/kcrash`.

Kdump functionality is mainly provided by the following packages:
* `sys-kernel/chromeos-kernel-kdump-5_15`: The kdump kernel image.
* `sys-boot/kdump-ramfs`: The initramfs for the kdump kernel. It executes
  `makedumpfile` to generate the crash dump. Note that the artifacts of this
  package are only bundled into kdump kernel image, not the main device image.
* `sys-apps/kexec-lite`: A simple `kexec-tools` implementation to load the kdump kernel.
* `sys-boot/kdump-init`: The script that runs `kexec-lite` to load the
  kdump kernel.
* `sys-apps/kdump-dev`: The script that collects the dump files generated by
  `kdump-ramfs` and saves them to `/var/spool/kcrash`.
