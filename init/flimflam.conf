# Copyright (c) 2009 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# flimflam
#
# starts flimflam once wpasupplicant and udevd have been started.

start on started wpasupplicant and started udev

pre-start script
    if [ -e /mnt/stateful_partition/.recovery ]; then
      echo "`date`: Recovery boot. Not start flimflam" >> /var/log/recovery.log
      sleep 365d  # sleep for a long time
    fi
end script

respawn
expect fork
# -k filename: Filename to read keymatter from for encrypted configuration data.
exec /usr/sbin/flimflamd -k /var/lib/whitelist/owner.key

post-start script
  # udevd can now advertise to flimflam the builtin WIFI device exists.
  /sbin/udevadm trigger --action=add --sysname-match=wlan0
end script
