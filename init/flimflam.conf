# Copyright (c) 2009 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# flimflam
#
# starts flimflam once wpasupplicant has been started.

start on started wpasupplicant

pre-start script
    if [ -e /mnt/stateful_partition/.recovery ]; then
      echo "`date`: Recovery boot. Not start flimflam" >> /var/log/recovery.log
      sleep 365d  # sleep for a long time
    fi
end script

respawn
expect fork
# -W nl80211: use nl80211 instead of wext
# -P newwifi: exclude new wifi plugin so we use old one (for now)
# -k filename: Filename to read keymatter from for encrypted configuration data.
exec /usr/sbin/flimflamd -W nl80211 -P newwifi -k /var/lib/whitelist/owner.key
