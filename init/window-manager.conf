# Copyright (c) 2010 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

description   "Run the window manager"
author        "chromium-os-dev@chromium.org"

start on x-started
stop on stopping ui

# Sadly, these can't reference each other.
env DATA_DIR=/home/chronos
env HOME=/home/chronos/user
env XAUTHORITY=/home/chronos/.Xauthority
env DISPLAY=:0.0
env USER_ID=1000
env PULSE_RUNTIME_PATH=/var/run/pulse

respawn
script

WM="/usr/bin/chromeos-wm"
IMAGES="/usr/share/chromeos-assets/images"
INITIAL_CHROME_FILE="/var/run/state/windowmanager/initial-chrome-window-mapped"
LOGGED_IN_LOG_DIR="${HOME}/log"
LOGGED_OUT_LOG_DIR="/var/log/window_manager"
LOGGED_IN_SCREENSHOT_DIR="${HOME}/Downloads/Screenshots"
LOGGED_OUT_SCREENSHOT_DIR="/tmp"
XTERM_COMMAND="/usr/local/bin/xterm -bg black -fg grey +sb"

cd /
exec /sbin/minijail --uid=${USER_ID} --                                \
  "${WM}"                                                              \
    --hotkey_overlay_image_dir="${IMAGES}"                             \
    --panel_anchor_image="${IMAGES}/panel_anchor.png"                  \
    --panel_dock_background_image="${IMAGES}/panel_dock_bg.png"        \
    --shadow_image_dir="${IMAGES}"                                     \
    --background_image="${IMAGES}/background_1024x600.png"             \
    --initial_chrome_window_mapped_file="${INITIAL_CHROME_FILE}"       \
    --logged_in_log_dir="${LOGGED_IN_LOG_DIR}"                         \
    --logged_out_log_dir="${LOGGED_OUT_LOG_DIR}"                       \
    --logged_in_screenshot_output_dir="${LOGGED_IN_SCREENSHOT_DIR}"    \
    --logged_out_screenshot_output_dir="${LOGGED_OUT_SCREENSHOT_DIR}"  \
    --separator_image="${IMAGES}/separator.png"                        \
    --xterm_command="${XTERM_COMMAND}"
end script
