# Copyright (c) 2010 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

description   "Run ibus-daemon and ibus-memconf"
author        "chromium-os-dev@googlegroups.com"

stop on stopping ui

# ibus-daemon creates a temporary file in /home/chronos,
# not in /home/chronos/user.
env HOME=/home/chronos

post-stop script

set +e
. /sbin/killers

# Ensure ibus-daemon  and sub-processes are terminated. Note that these
# processes are not mananged by Upstart.
term_process "(candidate_w.*|ibus-[dem].*)"

# Since Chrome OS regenerates /var/lib/dbus/machine-id every time when the OS
# starts, ibus-daemon creates a new file in ${HOME}/.config/ibus/bus/ every time
# when it starts. It's better to remove them when ibus-daemon is terminated.
rm -f ${HOME}/.config/ibus/bus/*

end script
