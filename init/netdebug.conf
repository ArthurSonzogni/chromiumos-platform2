# Copyright (c) 2009 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# netdebug
#
# enables network debugging once flimflam has been started.

start on started flimflam

# Tells upstart not to manage this script as a service so that it
# is only run once.
task

script
  # enable flimflam wifi debug msgs if python is available
  # NB: /usr/lib vs /usr/local/lib is for compat w/ old layouts
  /usr/lib/flimflam/test/debug wifi || \
    /usr/local/lib/flimflam/test/debug wifi || true
  # set wpa_supplicant debug level to 1, disable timestamps, disable show_keys
  dbus-send --system --dest=fi.epitest.hostap.WPASupplicant --print-reply \
    /fi/epitest/hostap/WPASupplicant \
    fi.epitest.hostap.WPASupplicant.setDebugParams \
    int32:1 boolean:false boolean:false
  # mount debugfs for access to mac80211 and driver data
  test -d /sys/kernel/debug/ieee80211 || \
    (mount -n -t debugfs debugfs /sys/kernel/debug || true) >/dev/null 2>&1
  # add other stuff here
end script
