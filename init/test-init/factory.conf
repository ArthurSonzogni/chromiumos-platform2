# Copyright (c) 2013 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

description   "Chrome OS factory startup stub"
author        "chromium-os-dev@chromium.org"

# The start/stop timing should be the same (or earlier than) to ui.conf
start on started boot-services
stop on starting pre-shutdown

pre-start script
  . /usr/share/cros/factory_utils.sh
  if ! is_factory_mode; then
    stop
  fi

  # Preventing tty2 (developer shell console) to go blank after some idle time
  for i in $(seq 2 4); do
    setterm -cursor on -blank 0 -powersave off -powerdown 0 >/dev/tty${i} || true
  done
end script

script
  exec "/usr/local/factory/bin/goofy_control" start >/dev/tty4
end script

pre-stop script
  # Try to stop UI before we kill X
  stop ui
  pkill python
  pkill X
end script
