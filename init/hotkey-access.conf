# Copyright (c) 2010 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

description     "Determine whether to allow certain keyboard hotkey sequences"
author          "chromium-os-dev@chromium.org"

# This job determines whether to enable the console hotkeys for 'sysrq'.
start on startup

script

  # Only allow the 'x' sysrq key, unless this is a "developer system".
  # We define "developer system" as either a) a system with the
  # developer hardware switch set on, or b) a system with a shared
  # user password set (meaning it's possible to log in on a VT
  # console).
  #
  # If you are editing this if-condition, please also update
  # platform/login_manager/xstart.sh.
  if crossystem "cros_debug?1" ||
      grep -q '^chronos:[^*]' /etc/shadow; then
    # developer end-user - allow the keys
    echo 1 > /proc/sys/kernel/sysrq
  else
    # consumer end-user - only allow the sysrq 'x' key.
    echo 0x1000 > /proc/sys/kernel/sysrq
  fi
end script
