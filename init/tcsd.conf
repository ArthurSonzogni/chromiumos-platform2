# Copyright (c) 2010 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# Trousers daemon, which talks to the TPM (or the TPM emulator).
# Started directly from tpm-probe.

stop on starting halt or starting reboot

respawn
expect fork

pre-start script
if [ "0" = $(cat /sys/class/misc/tpm0/device/owned) ]; then
  # clean up any existing tcsd state.
  rm -rf /var/lib/tpm/*
fi
end script

exec /usr/sbin/tcsd

post-start exec /usr/sbin/chromeos_tpm_init
