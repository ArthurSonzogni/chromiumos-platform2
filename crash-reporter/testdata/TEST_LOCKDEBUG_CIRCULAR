[   44.421050] ======================================================
[   44.421081] WARNING: possible circular locking dependency detected
[   44.421113] 5.15.180-kasan-lockdep-24494-gc7c1b8d2fd39 #1 Not tainted
[   44.421151] ------------------------------------------------------
[   44.421180] chrome/1993 is trying to acquire lock:
[   44.421215] ffffffc0132e22a0 (&kctx->reg_lock){+.+.}-{3:3}, at: kbase_gpu_vm_lock+0x30/0x40
[   44.421345] 
[   44.421345] but task is already holding lock:
[   44.421373] ffffff80d304b128 (&mm->mmap_lock){++++}-{3:3}, at: vm_mmap_pgoff+0xf4/0x224
[   44.421482] 
[   44.421482] which lock already depends on the new lock.
[   44.421482] 
[   44.421510] 
[   44.421510] the existing dependency chain (in reverse order) is:
[   44.421540] 
[   44.421540] -> #6 (&mm->mmap_lock){++++}-{3:3}:
[   44.421620]        __might_fault+0xc4/0x2b0
[   44.421672]        filldir64+0x254/0x9cc
[   44.421726]        dcache_readdir+0x3a4/0x47c
[   44.421776]        iterate_dir+0x188/0x4e0
[   44.421826]        __arm64_sys_getdents64+0xd8/0x514
[   44.421878]        invoke_syscall+0xe0/0x268
[   44.421926]        el0_svc_common+0x234/0x3c4
[   44.421971]        do_el0_svc+0x9c/0x19c
[   44.422015]        el0_svc+0x5c/0xbc
[   44.422061]        el0t_64_sync_handler+0x98/0xac
[   44.422107]        el0t_64_sync+0x1a4/0x1a8
[   44.422153] 
[   44.422153] -> #5 (&sb->s_type->i_mutex_key#3){++++}-{3:3}:
[   44.422247]        down_write+0xb8/0x2e8
[   44.422299]        simple_recursive_removal+0x94/0x6b0
[   44.422348]        debugfs_remove+0x68/0x90
[   44.422396]        _regulator_put+0x100/0x464
[   44.422447]        regulator_put+0x3c/0x54
[   44.422495]        devm_regulator_release+0x44/0x54
[   44.422544]        devres_release_all+0x15c/0x1dc
[   44.422592]        really_probe+0x4ac/0xae0
[   44.422639]        __driver_probe_device+0x188/0x318
[   44.422686]        driver_probe_device+0x80/0x340
[   44.422732]        __device_attach_driver+0x27c/0x4c0
[   44.422779]        bus_for_each_drv+0x118/0x18c
[   44.422830]        __device_attach+0x268/0x35c
[   44.422875]        device_initial_probe+0x2c/0x3c
[   44.422920]        bus_probe_device+0xc4/0x1cc
[   44.422970]        deferred_probe_work_func+0x1b4/0x240
[   44.423017]        process_one_work+0x5cc/0x1b2c
[   44.423063]        worker_thread+0xa3c/0xf74
[   44.423107]        kthread+0x378/0x458
[   44.423158]        ret_from_fork+0x10/0x20
[   44.423204] 
[   44.423204] -> #4 (regulator_list_mutex){+.+.}-{3:3}:
[   44.423287]        __mutex_lock_common+0xd4/0x16c8
[   44.423340]        mutex_lock_nested+0x9c/0xb0
[   44.423389]        regulator_lock_dependent+0x60/0x56c
[   44.423442]        regulator_enable+0x70/0xf0
[   44.423491]        kbase_pm_callback_power_on+0x118/0x8e4
[   44.423546]        kbase_pm_init_hw+0xf4/0xf00
[   44.423592]        kbase_hwaccess_pm_powerup+0x58/0x2ec
[   44.423647]        kbase_backend_late_init+0x74/0x1b0
[   44.423699]        kbase_device_init+0xc4/0x238
[   44.423746]        kbase_platform_device_probe+0xd4/0x220
[   44.423797]        platform_probe+0x144/0x1bc
[   44.423842]        really_probe+0x274/0xae0
[   44.423887]        __driver_probe_device+0x188/0x318
[   44.423934]        driver_probe_device+0x80/0x340
[   44.423980]        __device_attach_driver+0x27c/0x4c0
[   44.424027]        bus_for_each_drv+0x118/0x18c
[   44.424076]        __device_attach_async_helper+0x180/0x204
[   44.424125]        async_run_entry_fn+0xa0/0x3bc
[   44.424180]        process_one_work+0x5cc/0x1b2c
[   44.424225]        worker_thread+0x454/0xf74
[   44.424269]        kthread+0x378/0x458
[   44.424318]        ret_from_fork+0x10/0x20
[   44.424364] 
[   44.424364] -> #3 (&kbdev->pm.lock){+.+.}-{3:3}:
[   44.424446]        __mutex_lock_common+0xd4/0x16c8
[   44.424498]        mutex_lock_nested+0x9c/0xb0
[   44.424548]        kbase_hwaccess_pm_powerup+0x4c/0x2ec
[   44.424601]        kbase_backend_late_init+0x74/0x1b0
[   44.424653]        kbase_device_init+0xc4/0x238
[   44.424699]        kbase_platform_device_probe+0xd4/0x220
[   44.424749]        platform_probe+0x144/0x1bc
[   44.424793]        really_probe+0x274/0xae0
[   44.424839]        __driver_probe_device+0x188/0x318
[   44.424885]        driver_probe_device+0x80/0x340
[   44.424931]        __device_attach_driver+0x27c/0x4c0
[   44.424979]        bus_for_each_drv+0x118/0x18c
[   44.425028]        __device_attach_async_helper+0x180/0x204
[   44.425076]        async_run_entry_fn+0xa0/0x3bc
[   44.425129]        process_one_work+0x5cc/0x1b2c
[   44.425174]        worker_thread+0x454/0xf74
[   44.425217]        kthread+0x378/0x458
[   44.425267]        ret_from_fork+0x10/0x20
[   44.425311] 
[   44.425311] -> #2 (&jsdd->runpool_mutex){+.+.}-{3:3}:
[   44.425393]        __mutex_lock_common+0xd4/0x16c8
[   44.425444]        mutex_lock_nested+0x9c/0xb0
[   44.425494]        kbase_pm_context_active_handle_suspend+0x4c/0x2b8
[   44.425548]        kbase_js_sched+0x4bc/0x1c94
[   44.425595]        kbasep_js_schedule_privileged_ctx+0x1a8/0x3a8
[   44.425647]        kbasep_hwcnt_backend_jm_init+0x280/0x514
[   44.425701]        kbasep_hwcnt_backend_jm_watchdog_init+0x1ec/0x470
[   44.425758]        kbase_hwcnt_accumulator_acquire+0x13c/0x5f8
[   44.425809]        kbase_hwcnt_virtualizer_client_create+0x8f8/0xed8
[   44.425864]        kbase_ipa_attach_vinstr+0x774/0x8f8
[   44.425912]        kbase_ipa_vinstr_common_model_init+0x370/0x434
[   44.425961]        kbase_g52_r1_power_model_init+0x40/0x50
[   44.426009]        kbase_ipa_init_model+0x194/0x4f8
[   44.426054]        kbase_ipa_init+0x520/0x7b0
[   44.426098]        kbase_devfreq_init+0x494/0x1c24
[   44.426148]        kbase_backend_devfreq_init+0x28/0x8c
[   44.426203]        kbase_backend_late_init+0xe0/0x1b0
[   44.426255]        kbase_device_init+0xc4/0x238
[   44.426300]        kbase_platform_device_probe+0xd4/0x220
[   44.426351]        platform_probe+0x144/0x1bc
[   44.426395]        really_probe+0x274/0xae0
[   44.426440]        __driver_probe_device+0x188/0x318
[   44.426487]        driver_probe_device+0x80/0x340
[   44.426533]        __device_attach_driver+0x27c/0x4c0
[   44.426580]        bus_for_each_drv+0x118/0x18c
[   44.426629]        __device_attach_async_helper+0x180/0x204
[   44.426678]        async_run_entry_fn+0xa0/0x3bc
[   44.426730]        process_one_work+0x5cc/0x1b2c
[   44.426775]        worker_thread+0x454/0xf74
[   44.426819]        kthread+0x378/0x458
[   44.426868]        ret_from_fork+0x10/0x20
[   44.426913] 
[   44.426913] -> #1 (&jsdd->queue_mutex){+.+.}-{3:3}:
[   44.426996]        __mutex_lock_common+0xd4/0x16c8
[   44.427048]        mutex_lock_nested+0x9c/0xb0
[   44.427098]        mmu_flush_invalidate+0x88/0x164
[   44.427150]        mmu_flush_invalidate_insert_pages+0x150/0x2e0
[   44.427203]        kbase_mmu_insert_pages+0xe4/0x124
[   44.427254]        kbase_gpu_mmap+0x6c4/0xbc4
[   44.427307]        kbase_mem_alloc+0xcf8/0x15e8
[   44.427357]        kbasep_hwcnt_backend_jm_init+0x2ec/0x514
[   44.427411]        kbasep_hwcnt_backend_jm_watchdog_init+0x1ec/0x470
[   44.427467]        kbase_hwcnt_accumulator_acquire+0x13c/0x5f8
[   44.427519]        kbase_hwcnt_virtualizer_client_create+0x8f8/0xed8
[   44.427574]        kbase_ipa_attach_vinstr+0x774/0x8f8
[   44.427621]        kbase_ipa_vinstr_common_model_init+0x370/0x434
[   44.427671]        kbase_g52_r1_power_model_init+0x40/0x50
[   44.427718]        kbase_ipa_init_model+0x194/0x4f8
[   44.427763]        kbase_ipa_init+0x520/0x7b0
[   44.427807]        kbase_devfreq_init+0x494/0x1c24
[   44.427857]        kbase_backend_devfreq_init+0x28/0x8c
[   44.427911]        kbase_backend_late_init+0xe0/0x1b0
[   44.427963]        kbase_device_init+0xc4/0x238
[   44.428009]        kbase_platform_device_probe+0xd4/0x220
[   44.428060]        platform_probe+0x144/0x1bc
[   44.428104]        really_probe+0x274/0xae0
[   44.428150]        __driver_probe_device+0x188/0x318
[   44.428197]        driver_probe_device+0x80/0x340
[   44.428243]        __device_attach_driver+0x27c/0x4c0
[   44.428290]        bus_for_each_drv+0x118/0x18c
[   44.428339]        __device_attach_async_helper+0x180/0x204
[   44.428387]        async_run_entry_fn+0xa0/0x3bc
[   44.428440]        process_one_work+0x5cc/0x1b2c
[   44.428485]        worker_thread+0x454/0xf74
[   44.428528]        kthread+0x378/0x458
[   44.428579]        ret_from_fork+0x10/0x20
[   44.428623] 
[   44.428623] -> #0 (&kctx->reg_lock){+.+.}-{3:3}:
[   44.428708]        __lock_acquire+0x285c/0x6bd8
[   44.428763]        lock_acquire+0x1ec/0x65c
[   44.428813]        __mutex_lock_common+0xd4/0x16c8
[   44.428865]        mutex_lock_nested+0x9c/0xb0
[   44.428915]        kbase_gpu_vm_lock+0x30/0x40
[   44.428967]        kbase_context_get_unmapped_area+0x2cc/0x68c
[   44.429021]        kbase_get_unmapped_area+0xe0/0x2bc
[   44.429070]        do_mmap+0x2c8/0x86c4
[   44.429119]        vm_mmap_pgoff+0x134/0x224
[   44.429168]        ksys_mmap_pgoff+0xe0/0x19c
[   44.429217]        __arm64_sys_mmap+0x100/0x118
[   44.429270]        invoke_syscall+0xe0/0x268
[   44.429316]        el0_svc_common+0x234/0x3c4
[   44.429361]        do_el0_svc+0x9c/0x19c
[   44.429405]        el0_svc+0x5c/0xbc
[   44.429449]        el0t_64_sync_handler+0x98/0xac
[   44.429496]        el0t_64_sync+0x1a4/0x1a8
[   44.429541] 
[   44.429541] other info that might help us debug this:
[   44.429541] 
[   44.429570] Chain exists of:
[   44.429570]   &kctx->reg_lock --> &sb->s_type->i_mutex_key#3 --> &mm->mmap_lock
[   44.429570] 
[   44.429683]  Possible unsafe locking scenario:
[   44.429683] 
[   44.429710]        CPU0                    CPU1
[   44.429737]        ----                    ----
[   44.429764]   lock(&mm->mmap_lock);
[   44.429811]                                lock(&sb->s_type->i_mutex_key#3);
[   44.429874]                                lock(&mm->mmap_lock);
[   44.429923]   lock(&kctx->reg_lock);
[   44.429971] 
[   44.429971]  *** DEADLOCK ***
[   44.429971] 
[   44.429997] 1 lock held by chrome/1993:
[   44.430034]  #0: ffffff80d304b128 (&mm->mmap_lock){++++}-{3:3}, at: vm_mmap_pgoff+0xf4/0x224
[   44.430154] 
[   44.430154] stack backtrace:
[   44.430184] CPU: 5 PID: 1993 Comm: chrome Not tainted 5.15.180-kasan-lockdep-24494-gc7c1b8d2fd39 #1 dfd77821ac6d43b47f4d5fd37b09b6d4b7a00cc6
[   44.430245] Hardware name: Google Kyogre board (DT)
[   44.430279] Call trace:
[   44.430306]  dump_backtrace+0x0/0x3d0
[   44.430357]  show_stack+0x34/0x50
[   44.430405]  __dump_stack+0x30/0x40
[   44.430453]  dump_stack_lvl+0xe0/0x134
[   44.430500]  dump_stack+0x1c/0x4c
[   44.430546]  print_circular_bug+0x41c/0x530
[   44.430591]  check_noncircular+0x1dc/0x270
[   44.430636]  __lock_acquire+0x285c/0x6bd8
[   44.430689]  lock_acquire+0x1ec/0x65c
[   44.430739]  __mutex_lock_common+0xd4/0x16c8
[   44.430791]  mutex_lock_nested+0x9c/0xb0
[   44.430841]  kbase_gpu_vm_lock+0x30/0x40
[   44.430894]  kbase_context_get_unmapped_area+0x2cc/0x68c
[   44.430950]  kbase_get_unmapped_area+0xe0/0x2bc
[   44.430999]  do_mmap+0x2c8/0x86c4
[   44.431047]  vm_mmap_pgoff+0x134/0x224
[   44.431095]  ksys_mmap_pgoff+0xe0/0x19c
[   44.431144]  __arm64_sys_mmap+0x100/0x118
[   44.431196]  invoke_syscall+0xe0/0x268
[   44.431242]  el0_svc_common+0x234/0x3c4
[   44.431287]  do_el0_svc+0x9c/0x19c
[   44.431331]  el0_svc+0x5c/0xbc
[   44.431376]  el0t_64_sync_handler+0x98/0xac
[   44.431423]  el0t_64_sync+0x1a4/0x1a8
[   44.735651] kobject: 'rx-0' (000000009cdbc158): kobject_release, parent 0000000057da7ac8 (delayed 3000)
[   44.736245] kobject: 'tx-0' (00000000d3eeb0eb): kobject_release, parent 0000000057da7ac8 (delayed 3000)
[   45.989042] loop3: detected capacity change from 0 to 10376
